# PHP socket读写总结

## fread
- 缓冲区没有数据：阻塞模式下阻塞，非阻塞模式下，直接返回空字符串
- 缓冲区有数据：立即返回数据，如果数据长度小于fread参数长度，则返回全部数据
- 连接关闭: 直接返回空字符串

## fwrite

> fwrite函数执行过程中，tcp协议会不停的将写缓冲区的数据发送到对方socket的读缓冲区中，因此，fwrite可发送的最大数据长度要大于写缓冲区的大小，理论上，只要对方socket一直在读数据，无论多大的数据都可以通过一次fwrite函数调用来发送，但是可能会消耗比较多的时间。如果采用异步发送的方式，尽量将数据分成一小段一小段的发送。

- 阻塞模式：阻塞模式下，fwrite会一直等待数据发送完成之后返回，如果数据超过写缓冲区大小，会等待tcp协议将写缓冲区数据发送出去腾出更多的空间，理论上，只要对方socket在不停读数据，无论多大的数据，都是可以通过一次fwrite调用发送完成的。
- 非阻塞模式：非阻塞模式下，fwrite发送数据的过程中，tcp协议也会一直将写缓冲的数据发送出去，因此，非阻塞模式下可发送的最大数据量也可以超过写缓冲区的大小。但是与阻塞模式不同的是，如果对方socket不能及时读取数据，导致对方socket读缓冲区满，tcp协议无法将写缓冲区数据发送出去的时候，阻塞模式会一直阻塞直到数据发送完毕，而非阻塞模式下会直接返回已发送的数据长度。

> 注：如果对方关闭连接，fwrite待发送的数据小于写缓冲区剩余大小，直接返回发送长度。如果大于写缓冲区剩余大小，返回实际写入长度并抛出notice
